{"ast":null,"code":"import _createForOfIteratorHelper from\"D:/Curs-Scoala informala de IT/week1-15_all-homeworks/week15_homework_Rick and Morty API_React_useContext+customHook/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _slicedToArray from\"D:/Curs-Scoala informala de IT/week1-15_all-homeworks/week15_homework_Rick and Morty API_React_useContext+customHook/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useCallback,useState}from\"react\";import config from\"../config\";// requestConfig = {\n//   link,\n//   errorMessage,\n//   urlParams: [{property: \"episode\", value: \"S01E01\", required: true/false}]\n// };\nvar useHttp=function useHttp(applyData){var _useState=useState(true),_useState2=_slicedToArray(_useState,2),isLoading=_useState2[0],setIsLoading=_useState2[1];// delete baseURL from the new link\n// because charcater API already contains baseURL \nvar prepareLink=function prepareLink(newLink){return newLink.replace(config.api.baseURL,\"\");};var processURLParams=function processURLParams(urlParams){var queryArr=[];if(!urlParams){return\"\";}var _iterator=_createForOfIteratorHelper(urlParams),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var param=_step.value;if(param.required&&!param.value){throw new Error(\"Value not defined for \".concat(param.property));}queryArr.push(\"\".concat(param.property,\"=\").concat(param.value));}}catch(err){_iterator.e(err);}finally{_iterator.f();}return\"?\"+queryArr.join(\"&\");};var sendRequest=useCallback(function(requestConfig){try{var url=config.api.baseURL+prepareLink(requestConfig.link)+processURLParams(requestConfig.urlParams);setIsLoading(true);fetch(url,{method:\"GET\"}).then(function(response){if(!response.ok){return Promise.reject(new Error(requestConfig.errorMessage));}return response.json();}).then(function(data){applyData(data);setIsLoading(false);}).catch(function(error){console.log(error.message);setIsLoading(false);});}catch(error){// setIsLoading(false);\n}},[applyData]);return{isLoading:isLoading,sendRequest:sendRequest};};export default useHttp;","map":{"version":3,"names":["useCallback","useState","config","useHttp","applyData","isLoading","setIsLoading","prepareLink","newLink","replace","api","baseURL","processURLParams","urlParams","queryArr","param","required","value","Error","property","push","join","sendRequest","requestConfig","url","link","fetch","method","then","response","ok","Promise","reject","errorMessage","json","data","catch","error","console","log","message"],"sources":["D:/Curs-Scoala informala de IT/week1-15_all-homeworks/week15_homework_Rick and Morty API_React_useContext+customHook/src/hooks/use-http.js"],"sourcesContent":["import { useCallback, useState } from \"react\";\r\n\r\nimport config from \"../config\";\r\n\r\n// requestConfig = {\r\n//   link,\r\n//   errorMessage,\r\n//   urlParams: [{property: \"episode\", value: \"S01E01\", required: true/false}]\r\n// };\r\n\r\nconst useHttp = (applyData) => {\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  // delete baseURL from the new link\r\n  // because charcater API already contains baseURL \r\n  const prepareLink = (newLink) => {\r\n    return newLink.replace(config.api.baseURL, \"\");\r\n  };\r\n\r\n  const processURLParams = (urlParams) => {\r\n    let queryArr = [];\r\n    if (!urlParams) {\r\n      return \"\";\r\n    }\r\n    for (let param of urlParams) {\r\n      if (param.required && !param.value) {\r\n        throw new Error(`Value not defined for ${param.property}`);\r\n      }\r\n      queryArr.push(`${param.property}=${param.value}`);\r\n    }\r\n    return \"?\" + queryArr.join(\"&\");\r\n  };\r\n\r\n  const sendRequest = useCallback(\r\n    (requestConfig) => {\r\n      try {\r\n        const url =\r\n          config.api.baseURL +\r\n          prepareLink(requestConfig.link) +\r\n          processURLParams(requestConfig.urlParams);\r\n\r\n        setIsLoading(true);\r\n\r\n        fetch(url, {\r\n          method: \"GET\",\r\n        })\r\n          .then((response) => {\r\n            if (!response.ok) {\r\n              return Promise.reject(new Error(requestConfig.errorMessage));\r\n            }\r\n            return response.json();\r\n          })\r\n          .then((data) => {\r\n            applyData(data);\r\n            setIsLoading(false);\r\n          })\r\n          .catch((error) => {\r\n            console.log(error.message);\r\n            setIsLoading(false);\r\n          });\r\n      } catch (error) {\r\n        // setIsLoading(false);\r\n      }\r\n    },\r\n    [applyData]\r\n  );\r\n\r\n  return {\r\n    isLoading,\r\n    sendRequest,\r\n  };\r\n};\r\n\r\nexport default useHttp;\r\n"],"mappings":"4aAAA,OAASA,WAAT,CAAsBC,QAAtB,KAAsC,OAAtC,CAEA,MAAOC,OAAP,KAAmB,WAAnB,CAEA;AACA;AACA;AACA;AACA;AAEA,GAAMC,QAAO,CAAG,QAAVA,QAAU,CAACC,SAAD,CAAe,CAC7B,cAAkCH,QAAQ,CAAC,IAAD,CAA1C,wCAAOI,SAAP,eAAkBC,YAAlB,eAEA;AACA;AACA,GAAMC,YAAW,CAAG,QAAdA,YAAc,CAACC,OAAD,CAAa,CAC/B,MAAOA,QAAO,CAACC,OAAR,CAAgBP,MAAM,CAACQ,GAAP,CAAWC,OAA3B,CAAoC,EAApC,CAAP,CACD,CAFD,CAIA,GAAMC,iBAAgB,CAAG,QAAnBA,iBAAmB,CAACC,SAAD,CAAe,CACtC,GAAIC,SAAQ,CAAG,EAAf,CACA,GAAI,CAACD,SAAL,CAAgB,CACd,MAAO,EAAP,CACD,CAJqC,yCAKpBA,SALoB,YAKtC,+CAA6B,IAApBE,MAAoB,aAC3B,GAAIA,KAAK,CAACC,QAAN,EAAkB,CAACD,KAAK,CAACE,KAA7B,CAAoC,CAClC,KAAM,IAAIC,MAAJ,iCAAmCH,KAAK,CAACI,QAAzC,EAAN,CACD,CACDL,QAAQ,CAACM,IAAT,WAAiBL,KAAK,CAACI,QAAvB,aAAmCJ,KAAK,CAACE,KAAzC,GACD,CAVqC,qDAWtC,MAAO,IAAMH,QAAQ,CAACO,IAAT,CAAc,GAAd,CAAb,CACD,CAZD,CAcA,GAAMC,YAAW,CAAGtB,WAAW,CAC7B,SAACuB,aAAD,CAAmB,CACjB,GAAI,CACF,GAAMC,IAAG,CACPtB,MAAM,CAACQ,GAAP,CAAWC,OAAX,CACAJ,WAAW,CAACgB,aAAa,CAACE,IAAf,CADX,CAEAb,gBAAgB,CAACW,aAAa,CAACV,SAAf,CAHlB,CAKAP,YAAY,CAAC,IAAD,CAAZ,CAEAoB,KAAK,CAACF,GAAD,CAAM,CACTG,MAAM,CAAE,KADC,CAAN,CAAL,CAGGC,IAHH,CAGQ,SAACC,QAAD,CAAc,CAClB,GAAI,CAACA,QAAQ,CAACC,EAAd,CAAkB,CAChB,MAAOC,QAAO,CAACC,MAAR,CAAe,GAAId,MAAJ,CAAUK,aAAa,CAACU,YAAxB,CAAf,CAAP,CACD,CACD,MAAOJ,SAAQ,CAACK,IAAT,EAAP,CACD,CARH,EASGN,IATH,CASQ,SAACO,IAAD,CAAU,CACd/B,SAAS,CAAC+B,IAAD,CAAT,CACA7B,YAAY,CAAC,KAAD,CAAZ,CACD,CAZH,EAaG8B,KAbH,CAaS,SAACC,KAAD,CAAW,CAChBC,OAAO,CAACC,GAAR,CAAYF,KAAK,CAACG,OAAlB,EACAlC,YAAY,CAAC,KAAD,CAAZ,CACD,CAhBH,EAiBD,CAAC,MAAO+B,KAAP,CAAc,CACd;AACD,CACF,CA9B4B,CA+B7B,CAACjC,SAAD,CA/B6B,CAA/B,CAkCA,MAAO,CACLC,SAAS,CAATA,SADK,CAELiB,WAAW,CAAXA,WAFK,CAAP,CAID,CA7DD,CA+DA,cAAenB,QAAf"},"metadata":{},"sourceType":"module"}